pipeline {
    agent any
    parameters {
        booleanParam(name: 'IS_RELEASE', defaultValue: false, description: 'Deploy to Google Play Beta')
        booleanParam(name: 'IS_PR', defaultValue: false, description: 'Is a PR')
    }
    stages {
        stage("Start Emulator") {
            whenShouldRunTests()
            steps {
                echo 'Start Emulator'
            }
        }
        stage("JVM Tests") {
            whenShouldRunTests()
            steps {
                echo 'JVM Tests'
            }
        }
        stage("Connected Tests") {
            whenShouldRunTests()
            steps {
                echo 'Connected Tests'
            }
        }
        stage("Notify BitBucket") {
            whenPR()
            steps {
                echo 'Notify BitBucket'
            }
        }
        stage("Assemble APKs") {
            whenShouldGenerateBinaries()
            steps {
                echo 'Assemble APKs'
            }
        }
        stage("Crashlytics Upload") {
            whenShouldGenerateBinaries()
            steps {
                echo 'Crashlytics Upload'
            }
        }
        stage("Tag Build") {
            whenShouldGenerateBinaries()
            steps {
                echo 'Tag Builds'
            }
        }
        stage("Upload to Artifactory") {
            whenShouldGenerateBinaries()
            steps {
                echo 'Upload to Artifactory'
            }
        }
        stage("Select Release Tag") {
            whenRelease()
            steps {
                echo 'Select Release Tag'
            }
        }
        stage("Get from Artifactory") {
            whenRelease()
            steps {
                echo 'Get from Artifactory'
            }
        }
        stage("Upload to Google Play") {
            whenRelease()
            steps {
                echo 'Upload to Google Play'
            }
        }
        stage("Tag Release Build") {
            whenRelease()
            steps {
                echo 'Tag Release Build'
            }
        }
    }
}

def whenPR() {
    when {
        expression { params.is_PR == true }
    }
}

def whenRelease() {
    when {
        expression { params.IS_RELEASE == true }
    }
}

def whenShouldRunTests() {
    when {
        expression { params.IS_RELEASE == false }
    }
}

def whenShouldGenerateBinaries() {
    when { expression { params.IS_RELEASE == 'false' && params.IS_PR == 'false' } }
}
